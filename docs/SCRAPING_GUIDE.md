# æ—¥æœ¬èªåã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°æ‰‹é †

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€poe2db.twã‹ã‚‰æ—¥æœ¬èªã®ã‚¢ã‚¤ãƒ†ãƒ åã‚’å–å¾—ã—ã¦ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’æ›´æ–°ã™ã‚‹æ‰‹é †ã‚’èª¬æ˜ã—ã¾ã™ã€‚

## æ¦‚è¦

1. Itemsãƒšãƒ¼ã‚¸ã‹ã‚‰ã‚«ãƒ†ã‚´ãƒªãƒ‘ã‚¹ã‚’æŠ½å‡º
2. å„ã‚«ãƒ†ã‚´ãƒªãƒšãƒ¼ã‚¸ã‹ã‚‰æ—¥æœ¬èªåã‚’ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°
3. `japaneseNameMapping.json`ã‚’æ›´æ–°
4. `itemMap.json`ã‚’å†æ§‹ç¯‰

## æ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: ã‚«ãƒ†ã‚´ãƒªãƒ‘ã‚¹ã®æŠ½å‡º

Itemsãƒšãƒ¼ã‚¸ã‹ã‚‰ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒªãƒ‘ã‚¹ã‚’æŠ½å‡ºã—ã¾ã™ã€‚

```bash
npm run parse:category-paths
```

ã¾ãŸã¯

```bash
node scripts/parseItemsPage.js
```

**å‡ºåŠ›:**
- `scripts/tmp/category_paths.json` - æŠ½å‡ºã•ã‚ŒãŸã‚«ãƒ†ã‚´ãƒªãƒ‘ã‚¹ã®ãƒªã‚¹ãƒˆï¼ˆ60å€‹ç¨‹åº¦ï¼‰
- `scripts/tmp/items_page_debug.html` - ãƒ‡ãƒãƒƒã‚°ç”¨ã®HTMLãƒ•ã‚¡ã‚¤ãƒ«

**æ³¨æ„:** ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã¯ã€ã‚µã‚¤ãƒˆã®æ§‹é€ ãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆã‚„æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒªãŒè¿½åŠ ã•ã‚ŒãŸå ´åˆã«ã®ã¿å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

### ã‚¹ãƒ†ãƒƒãƒ—2: æ—¥æœ¬èªåã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°

å„ã‚«ãƒ†ã‚´ãƒªãƒšãƒ¼ã‚¸ã‹ã‚‰æ—¥æœ¬èªåã‚’å–å¾—ã—ã¦`japaneseNameMapping.json`ã‚’æ›´æ–°ã—ã¾ã™ã€‚

```bash
npm run fetch:japanese-names
```

**å‡¦ç†å†…å®¹:**
- `category_paths.json`ã‹ã‚‰è‡ªå‹•çš„ã«ãƒ‘ã‚¹ã‚’èª­ã¿è¾¼ã‚€
- å„ã‚«ãƒ†ã‚´ãƒªãƒšãƒ¼ã‚¸ã«é †æ¬¡ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆIPåˆ¶é™å¯¾ç­–: 2ç§’é–“éš”ï¼‰
- HTMLã‹ã‚‰æ—¥æœ¬èªåã‚’æŠ½å‡º
- `src/data/items/japaneseNameMapping.json`ã‚’æ›´æ–°

**å‡ºåŠ›ä¾‹:**
```
ğŸ”§ Fetching Japanese names from poe2db.tw...
ğŸ“‹ Processing 60 paths: Amulets, Augment, Belts, ...
âœ… Mapping updated:
   Updated: 125
   New: 19
   Total items in mapping: 946
```

**æ³¨æ„äº‹é …:**
- IPåˆ¶é™ã‚’é¿ã‘ã‚‹ãŸã‚ã€å„ãƒªã‚¯ã‚¨ã‚¹ãƒˆé–“ã«2ç§’ã®å¾…æ©Ÿæ™‚é–“ãŒã‚ã‚Šã¾ã™
- 60å€‹ã®ã‚«ãƒ†ã‚´ãƒªã‚’å‡¦ç†ã™ã‚‹ã®ã«ç´„2-3åˆ†ã‹ã‹ã‚Šã¾ã™
- ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€è©²å½“ã‚«ãƒ†ã‚´ãƒªã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ç¶šè¡Œã—ã¾ã™

### ã‚¹ãƒ†ãƒƒãƒ—3: itemMap.jsonã®å†æ§‹ç¯‰

æ›´æ–°ã•ã‚ŒãŸ`japaneseNameMapping.json`ã‹ã‚‰`itemMap.json`ã‚’å†æ§‹ç¯‰ã—ã¾ã™ã€‚

```bash
npm run build:item-map
```

**å‡¦ç†å†…å®¹:**
- `items.json`ã¨`japaneseNameMapping.json`ã‚’èª­ã¿è¾¼ã‚€
- æ—¥æœ¬èªåã‚’ã‚­ãƒ¼ã¨ã—ãŸãƒãƒƒãƒ—ã‚’ä½œæˆ
- `src/data/items/itemMap.json`ã‚’ç”Ÿæˆ

**å‡ºåŠ›ä¾‹:**
```
Building item map...
âœ… Item map built successfully.
   Total items: 946
   Mapped items: 213
```

## å®Œå…¨ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

ã™ã¹ã¦ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’ä¸€åº¦ã«å®Ÿè¡Œã™ã‚‹å ´åˆï¼š

```bash
# æ–¹æ³•1: ä¸€æ‹¬å®Ÿè¡Œï¼ˆæ¨å¥¨ï¼‰
npm run scrape:all

# æ–¹æ³•2: å€‹åˆ¥å®Ÿè¡Œ
# 1. ã‚«ãƒ†ã‚´ãƒªãƒ‘ã‚¹ã®æŠ½å‡ºï¼ˆåˆå›ã®ã¿ã€ã¾ãŸã¯ã‚µã‚¤ãƒˆæ§‹é€ ãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆï¼‰
npm run parse:category-paths

# 2. æ—¥æœ¬èªåã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°
npm run fetch:japanese-names

# 3. itemMap.jsonã®å†æ§‹ç¯‰
npm run build:item-map
```

## åˆ©ç”¨å¯èƒ½ãªnpmã‚¹ã‚¯ãƒªãƒ—ãƒˆ

| ã‚¹ã‚¯ãƒªãƒ—ãƒˆ                     | èª¬æ˜                                   |
| ------------------------------ | -------------------------------------- |
| `npm run parse:category-paths` | Itemsãƒšãƒ¼ã‚¸ã‹ã‚‰ã‚«ãƒ†ã‚´ãƒªãƒ‘ã‚¹ã‚’æŠ½å‡º      |
| `npm run fetch:japanese-names` | å„ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰æ—¥æœ¬èªåã‚’ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚° |
| `npm run build:item-map`       | itemMap.jsonã‚’å†æ§‹ç¯‰                   |
| `npm run scrape:all`           | ä¸Šè¨˜3ã¤ã‚’é †ç•ªã«å®Ÿè¡Œï¼ˆä¸€æ‹¬å®Ÿè¡Œï¼‰        |

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
scripts/
â”œâ”€â”€ parseItemsPage.js          # Itemsãƒšãƒ¼ã‚¸ã‹ã‚‰ã‚«ãƒ†ã‚´ãƒªãƒ‘ã‚¹ã‚’æŠ½å‡º
â”œâ”€â”€ fetchJapaneseNames.js     # å„ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰æ—¥æœ¬èªåã‚’ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°
â”œâ”€â”€ buildItemMap.js            # itemMap.jsonã‚’æ§‹ç¯‰
â””â”€â”€ tmp/                       # ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.gitignoreã«å«ã¾ã‚Œã‚‹ï¼‰
    â”œâ”€â”€ category_paths.json    # æŠ½å‡ºã•ã‚ŒãŸã‚«ãƒ†ã‚´ãƒªãƒ‘ã‚¹ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
    â”œâ”€â”€ items_page_debug.html  # Itemsãƒšãƒ¼ã‚¸ã®ãƒ‡ãƒãƒƒã‚°ç”¨HTML
    â””â”€â”€ debug_html.html        # ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°æ™‚ã®ãƒ‡ãƒãƒƒã‚°ç”¨HTML

src/data/items/
â”œâ”€â”€ japaneseNameMapping.json   # è‹±èªå â†’ æ—¥æœ¬èªåã®ãƒãƒƒãƒ”ãƒ³ã‚°
â”œâ”€â”€ itemMap.json               # æ—¥æœ¬èªå â†’ ã‚¢ã‚¤ãƒ†ãƒ æƒ…å ±ã®ãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
â””â”€â”€ items.json                 # å…ƒã®ã‚¢ã‚¤ãƒ†ãƒ ãƒ‡ãƒ¼ã‚¿
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚«ãƒ†ã‚´ãƒªãƒ‘ã‚¹ãŒè¦‹ã¤ã‹ã‚‰ãªã„

`scripts/tmp/category_paths.json`ãŒå­˜åœ¨ã—ãªã„ã€ã¾ãŸã¯å¤ã„å ´åˆï¼š

```bash
npm run parse:category-paths
```

### ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãŒå¤±æ•—ã™ã‚‹

ç‰¹å®šã®ã‚«ãƒ†ã‚´ãƒªã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å ´åˆï¼š

1. `scripts/tmp/debug_html.html`ã‚’ç¢ºèªã—ã¦HTMLæ§‹é€ ã‚’ç¢ºèª
2. `scripts/fetchJapaneseNames.js`ã®`parseHTML`é–¢æ•°ã‚’ä¿®æ­£
3. å¿…è¦ã«å¿œã˜ã¦ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’èª¿æ•´

### IPåˆ¶é™ã‚¨ãƒ©ãƒ¼

429ã‚¨ãƒ©ãƒ¼ï¼ˆRate Limitï¼‰ãŒç™ºç”Ÿã™ã‚‹å ´åˆï¼š

- `scripts/fetchJapaneseNames.js`ã®`delay`é–¢æ•°ã®å¾…æ©Ÿæ™‚é–“ã‚’å¢—ã‚„ã™
- ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ•°æ™‚é–“å¾Œã«å†å®Ÿè¡Œ

## ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### ç‰¹å®šã®ã‚«ãƒ†ã‚´ãƒªã®ã¿ã‚’å‡¦ç†ã™ã‚‹

`scripts/fetchJapaneseNames.js`ã®`loadCategoryPaths`é–¢æ•°ã‚’ä¿®æ­£ï¼š

```javascript
function loadCategoryPaths() {
  // ç‰¹å®šã®ã‚«ãƒ†ã‚´ãƒªã®ã¿ã‚’è¿”ã™
  return [
    "Stackable_Currency",
    "Essence",
    "Omen",
  ];
}
```

### å¾…æ©Ÿæ™‚é–“ã®èª¿æ•´

`scripts/fetchJapaneseNames.js`ã®`fetchItemsFromPath`é–¢æ•°å†…ã®`delay(2000)`ã‚’å¤‰æ›´ï¼š

```javascript
await delay(3000); // 3ç§’ã«å¤‰æ›´
```

## æ³¨æ„äº‹é …

- ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã¯ã‚µãƒ¼ãƒãƒ¼ã«è² è·ã‚’ã‹ã‘ã‚‹ãŸã‚ã€é©åº¦ãªé–“éš”ã‚’ç©ºã‘ã¦å®Ÿè¡Œã—ã¦ãã ã•ã„
- ã‚µã‚¤ãƒˆã®åˆ©ç”¨è¦ç´„ã‚’ç¢ºèªã—ã€éµå®ˆã—ã¦ãã ã•ã„
- HTMLæ§‹é€ ãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆã€ãƒ‘ãƒ¼ã‚µãƒ¼ã‚’æ›´æ–°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
